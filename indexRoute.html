<!DOCTYPE html>
<html lang="ru" style="scroll-behavior: smooth;scroll-behavior: cubic-bezier(0.42, 0, 0.58, 1);">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IncludHtml library</title>

<!--
  https://github.com/krasimir/navigo
  https://github.com/krasimir/navigo/blob/master/DOCUMENTATION.md
  <script src="https://cdnjs.cloudflare.com/ajax/libs/navigo/8.11.1/navigo.min.js" integrity="sha512-J8D8QABVZk+v5H+5nllq6DgHBiOcmhRjqAgJZm4d4d46JUBc1yrasvzbxbwNFLsK3FZmAS4TnjSyR5j7dyxdpw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
-->

  <script src="./IncludHtml.js" defer></script>
</head>

<body>

  <header>
    <h2>header</h2>
    <a href="#">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!index">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about">about</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about/1">about1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about/2">about2</a>&nbsp;&nbsp;&nbsp;
    <a href="#!nopage">404</a>&nbsp;&nbsp;&nbsp;
    <br><br>
    <a href="#span-id1">to span-id1</a>&nbsp;&nbsp;&nbsp;
    <a href="#span-id2">to span-id2</a>&nbsp;&nbsp;&nbsp;

    <style>
      p{
        max-width: 300px;
      }
    </style>
  </header>

  <!-- <section class="incs herro"
  data-incs='{"incFile": "./page-index/a_herro.html" }'
  ></section> -->
<!--
  "incFile": "./inc/main.html#extId", // путь до файла и id внутри определяет вставляемую часть
  "incInner" : true,  // [true], false -  определяет вставляемую часть:
                                        // true/false - innerHTML/outerHTML;
  "insertType": "replace",  // ["replace"],  "append", "prepend", - куда попадает вставляемое
  "incFromId": "extId"
 -->
  <main class="main incs-route" data-incs='{ "incFile": "./%routePage%%pageParams%" }'>
  </main>

  <footer><h2>footer</h2>
    <p>
      Lorem ipsum dolor sit, amet consectetur adipisicing elit. Sint a placeat harum molestias odit voluptatem natus debitis illo quis ea pariatur neque ad, amet non reprehenderit! Ab corporis corrupti beatae.
    Quibusdam sit atque quo maxime placeat quis consequuntur magnam earum facilis! Sit voluptatibus quas, ullam adipisci iure laudantium autem debitis quisquam earum pariatur fugiat possimus, blanditiis quasi quod ut consequatur!
    Sit a ullam animi quod quam vero soluta sapiente assumenda praesentium est. Quas id, magni natus quod nesciunt eum non aperiam minima quos libero nisi voluptates deserunt alias ipsum nam.
    Deleniti, voluptates? Totam fugit soluta eos molestias enim, neque quasi sit, placeat quae sint veritatis ipsum non voluptatum rem omnis assumenda nostrum nam in cumque distinctio. Quia aspernatur illo culpa!
    Odit magni ut numquam nam aperiam soluta blanditiis porro animi possimus cumque reprehenderit aliquid illum repellat voluptatum ipsum, hic nesciunt similique explicabo magnam excepturi asperiores repudiandae optio? Expedita, hic doloremque.
    Expedita, fugiat!
    <b><span id="span-id1">span-id1 doloremque</span></b>
    Dolorum, laudantium reprehenderit? Vel neque laboriosam tenetur. Eius dolores omnis nobis totam qui ea nostrum sunt. Sequi eos natus iusto porro distinctio veniam deleniti libero quas molestiae ad.
    In molestias totam, accusamus laboriosam fugiat officiis impedit quia accusantium rem deserunt ipsam vitae consectetur eveniet hic, culpa facilis? Dignissimos veritatis, iure enim adipisci quisquam fuga quas ipsam alias libero.
    Excepturi commodi inventore, cum debitis omnis tempore cupiditate! Aut repellendus, officiis quibusdam pariatur laborum consequuntur! Nemo voluptates perferendis explicabo, inventore velit, voluptatem, officiis nulla modi necessitatibus adipisci asperiores sequi. Nulla.
    Aliquam dolor itaque qui porro quo possimus, voluptatum ducimus quae explicabo asperiores mollitia, corporis nobis? Porro nihil sed a deleniti harum distinctio temporibus, exercitationem iste in minima repellendus. Deleniti, eveniet?
    Aliquid numquam aspernatur ipsam iure
    <b><span id="span-id2">span-id2 doloremque</span></b>
    dicta dolor nisi reiciendis quis similique, hic aut natus qui est culpa tempora quam eum animi voluptates cumque? Quas esse praesentium corporis similique commodi?
    Sint ipsa animi quod laborum? Adipisci sed perferendis, sunt quasi mollitia voluptate libero id nam assumenda repudiandae aperiam nihil delectus blanditiis deleniti facilis accusantium vel ad, nulla cum, accusamus rem!
    </p>
  </footer>

  <script>
//     const hashchangeHandler = () => {
//       debugger;
//       console.log('hashchangeHandler:', location.hash)
//       let curHash = location.hash.replaceAll('#','')
//       curHash = (curHash === '' ?  IncludHtml.routes[''].hash : curHash)
//       let curHash0 = curHash.split('/')[0]
//       if(curHash.startsWith('!')){
//         let pageParams = curHash.split('/').reduce((s,el,i) => {return i > 0 ? s + '/' + el : s;}, '')
//         if(location.hash.replaceAll('#','') != curHash){
//           IncludHtml.routes['%lastHash%'] = curHash
//           console.log('set location.hash = curHash:', curHash)
//           //location.hash = curHash
//           window.history.replaceState({}, null, location.href.split('#')[0] + '#' + curHash);
//           //return
//         }
//         let includ_url = ''
//         let def_param = ''
//         try{
//           if(!IncludHtml.routes[curHash0]){
//             console.error('Unsupported route:' + curHash0)
//             window.history.replaceState({}, null, location.href.split('#')[0] + '#' + IncludHtml.routes['%lastHash%']);
//             return
//           }
//           includ_url = IncludHtml.routes[curHash0].includ_url
//           if(!includ_url)
//             throw 'unsupported route [' + curHash0 + ']'
//           if(IncludHtml.routes[curHash0].def_param)
//             def_param = IncludHtml.routes[curHash0].def_param
//         }catch(e){
//           console.error('IncludHtml.routes["' + curHash0 + '"].includ_url\r\n', e)
//           window.history.replaceState({}, null, location.href.split('#')[0] + '#' + IncludHtml.routes['%lastHash%']);
//           // if(IncludHtml.routes['%lastHash%'])
//           //   location.hash = IncludHtml.routes['%lastHash%']
//           return;
//         }
//         //debugger
//         IncludHtml.routes['%lastHash%'] = curHash
//         pageParams  = pageParams || def_param
//         let pageParamsChanged = IncludHtml.routes['%pageParams%'] != pageParams;
//         IncludHtml.routes['%pageParams%'] = pageParams
//         if(IncludHtml.routes['%routePage%'] != includ_url){
// console.log('Render content for INCLUD url:', includ_url, ' prev INCLUD url:', IncludHtml.routes['%routePage%'], 'pageParams:', IncludHtml.routes['%pageParams%'])
//           IncludHtml.routes['%routePage%'] = includ_url
//           // меняем заголовок стр.
// //document.title = IncludHtml.routes[curHash0].title
//           // замена содержимого стр.
//           const a = document.querySelectorAll('.incs-route')
//           a.forEach((el) => {
//             el.innerHTML = ''
//             IncludHtml.doInsertInto(
//               el,
//               () => {
//                 console.log("IncludHtml.doInsertInto Finish: Ok");
//               }
//             )
//           })
//         }else{
//           if(pageParamsChanged){
//             console.log("pageParamsChanged '%pageParams%': ", IncludHtml.routes['%pageParams%']);
//           }
//         }
//       }else{
//         console.log('Link to Inner ref: ' + location.hash)
//         location.hash = IncludHtml.routes['%lastHash%']
//       }
//     }
    
    const routerParams = {
      urls: [
        {url:'', hash: '!index', includ_url:'page-index/main.html#extId', title:'main page'},
        {url:'!index', hash: '!index', includ_url:'page-index/main.html#extId', title:'main page'},
        {url:'!about', hash: '!about', includ_url:'page-about/main.html#extId', def_param: '/1', title:'about page'},
      ],
      hashChangeHandler: (urlObj, pageParams) => { //  (routePage, pageParams) => {
        console.log('=============hashchangeHandler', 'urlObj:', urlObj, 'pageParams:', pageParams)
        // меняем заголовок стр.
        document.title = urlObj.title
        // замена содержимого стр.
        const a = document.querySelectorAll('.incs-route')
        a.forEach((el) => {
          el.innerHTML = ''
          // в результате вызова IncludHtml.doInsertInto
          // в main добавляются элемены прописанные в его атрибуте data-incs='{ "incFile": "./inc/main.html#extId" }'
          //  т.е. содержимым ./inc/main.html с id="extId"
          IncludHtml.doInsertInto(
            el,
            () => {
              console.log("IncludHtml.doInsertInto Finish: Ok");
            }
          )
        })
      }, 
      paramChangeHandler: (urlObj, pageParams) => { //  (routePage, pageParams)
        console.log('=============paramChangeHandler', 'urlObj:', urlObj, 'pageParams:', pageParams)
        routerParams.hashChangeHandler(urlObj, pageParams)
      },
      // localLinkHandler: (urlObj, pageParams, link) => { //  (routePage, pageParams, link) 
      //   console.log('=============localLinkHandler', 'urlObj:', urlObj, 'pageParams:', pageParams, 'link:', link)
      // },
    }
    // routerParams.paramChangeHandler = routerParams.hashChangeHandler

    // window.onload = () => console.log('window onload');
    document.addEventListener("DOMContentLoaded", function () {
      IncludHtml.doIncludAll(
        {
          insertType: "append",
          incInner: false,
          replace: [
            { from: 'src="../img/', to: 'src="./img/' },
          ],
          "incFromId": "extId"
        },
        () => { // вызывается когда IncludHtml всё сделал
          const router = IncludHtml.CreateRouter(routerParams);
        }
      );
    });
  </script>
</body>

</html>
