<!DOCTYPE html>
<html lang="ru" style="scroll-behavior: smooth;scroll-behavior: cubic-bezier(0.42, 0, 0.58, 1);">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IncludHtml library</title>

<!--
  https://github.com/krasimir/navigo
  https://github.com/krasimir/navigo/blob/master/DOCUMENTATION.md
  <script src="https://cdnjs.cloudflare.com/ajax/libs/navigo/8.11.1/navigo.min.js" integrity="sha512-J8D8QABVZk+v5H+5nllq6DgHBiOcmhRjqAgJZm4d4d46JUBc1yrasvzbxbwNFLsK3FZmAS4TnjSyR5j7dyxdpw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
-->

  <script src="./IncludHtml.js" defer></script>
</head>

<body>

  <header>
    <h2>header</h2>
    <a href="#">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!index">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about">about</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about/1">about1</a>&nbsp;&nbsp;&nbsp;
    <a href="#!about/2">about2</a>&nbsp;&nbsp;&nbsp;
    <a href="#!nopage">404</a>&nbsp;&nbsp;&nbsp;
    <br><br>
    <a href="#span-id1">to span-id1</a>&nbsp;&nbsp;&nbsp;
    <a href="#span-id2">to span-id2</a>&nbsp;&nbsp;&nbsp;

    <style>
      p{
        max-width: 300px;
      }
    </style>
  </header>

  <!-- <section class="incs herro"
  data-incs='{"incFile": "./page-index/a_herro.html" }'
  ></section> -->
<!--
  "incFile": "./inc/main.html#extId", // Ð¿ÑƒÑ‚ÑŒ Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¸ id Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ÑƒÑŽ Ñ‡Ð°ÑÑ‚ÑŒ
  "incInner" : true,  // [true], false -  Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ÑƒÑŽ Ñ‡Ð°ÑÑ‚ÑŒ:
                                        // true/false - innerHTML/outerHTML;
  "insertType": "replace",  // ["replace"],  "append", "prepend", - ÐºÑƒÐ´Ð° Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼Ð¾Ðµ
  "incFromId": "extId"
 -->
  <main class="main incs-route" data-incs='{ "incFile": "./%routePage%" }'>
  </main>

  <footer><h2>footer</h2>
    <p>
      Lorem ipsum dolor sit, amet consectetur adipisicing elit. Sint a placeat harum molestias odit voluptatem natus debitis illo quis ea pariatur neque ad, amet non reprehenderit! Ab corporis corrupti beatae.
    Quibusdam sit atque quo maxime placeat quis consequuntur magnam earum facilis! Sit voluptatibus quas, ullam adipisci iure laudantium autem debitis quisquam earum pariatur fugiat possimus, blanditiis quasi quod ut consequatur!
    Sit a ullam animi quod quam vero soluta sapiente assumenda praesentium est. Quas id, magni natus quod nesciunt eum non aperiam minima quos libero nisi voluptates deserunt alias ipsum nam.
    Deleniti, voluptates? Totam fugit soluta eos molestias enim, neque quasi sit, placeat quae sint veritatis ipsum non voluptatum rem omnis assumenda nostrum nam in cumque distinctio. Quia aspernatur illo culpa!
    Odit magni ut numquam nam aperiam soluta blanditiis porro animi possimus cumque reprehenderit aliquid illum repellat voluptatum ipsum, hic nesciunt similique explicabo magnam excepturi asperiores repudiandae optio? Expedita, hic doloremque.
    Expedita, fugiat!
    <b><span id="span-id1">span-id1 doloremque</span></b>
    Dolorum, laudantium reprehenderit? Vel neque laboriosam tenetur. Eius dolores omnis nobis totam qui ea nostrum sunt. Sequi eos natus iusto porro distinctio veniam deleniti libero quas molestiae ad.
    In molestias totam, accusamus laboriosam fugiat officiis impedit quia accusantium rem deserunt ipsam vitae consectetur eveniet hic, culpa facilis? Dignissimos veritatis, iure enim adipisci quisquam fuga quas ipsam alias libero.
    Excepturi commodi inventore, cum debitis omnis tempore cupiditate! Aut repellendus, officiis quibusdam pariatur laborum consequuntur! Nemo voluptates perferendis explicabo, inventore velit, voluptatem, officiis nulla modi necessitatibus adipisci asperiores sequi. Nulla.
    Aliquam dolor itaque qui porro quo possimus, voluptatum ducimus quae explicabo asperiores mollitia, corporis nobis? Porro nihil sed a deleniti harum distinctio temporibus, exercitationem iste in minima repellendus. Deleniti, eveniet?
    Aliquid numquam aspernatur ipsam iure
    <b><span id="span-id2">span-id2 doloremque</span></b>
    dicta dolor nisi reiciendis quis similique, hic aut natus qui est culpa tempora quam eum animi voluptates cumque? Quas esse praesentium corporis similique commodi?
    Sint ipsa animi quod laborum? Adipisci sed perferendis, sunt quasi mollitia voluptate libero id nam assumenda repudiandae aperiam nihil delectus blanditiis deleniti facilis accusantium vel ad, nulla cum, accusamus rem!
    </p>
  </footer>

  <script>
    const hashchangeHandler = () => {
      let curHash = location.hash.replaceAll('#','')
      curHash = (curHash === '' ?  IncludHtml.routes[''].hash : curHash)
      let curHash0 = curHash.split('/')[0]
      if(curHash.startsWith('!')){
        let pageParams = curHash.split('/').reduce((s,el,i) => {return i > 0 ? s + '/' + el : s;}, '')
        if(location.hash.replaceAll('#','') != curHash){
          IncludHtml.routes['%lastHash%'] = curHash
          location.hash = curHash
          return
        }
        let url = ''
        try{
          url = IncludHtml.routes[curHash0].url
          if(!url)
            throw 'unsupported route [' + curHash0 + ']'
        }catch(e){
          console.error('IncludHtml.routes["' + curHash0 + '"].url\r\n', e)
          if(IncludHtml.routes['%lastHash%'])
            location.hash = IncludHtml.routes['%lastHash%']
          return;
        }
        IncludHtml.routes['%lastHash%'] = curHash
        let pageParamsChanged = IncludHtml.routes['%pageParams%'] != pageParams;
        IncludHtml.routes['%pageParams%'] = pageParams
        if(IncludHtml.routes['%routePage%'] != url){
          console.log('show url:', url, 'previouse url:', IncludHtml.routes['%routePage%'])
          IncludHtml.routes['%routePage%'] = url
          // Ð¼ÐµÐ½ÑÐµÐ¼ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº ÑÑ‚Ñ€.
          document.title = IncludHtml.routes[curHash0].title
          // Ð·Ð°Ð¼ÐµÐ½Ð° ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ð³Ð¾ ÑÑ‚Ñ€.
          const a = document.querySelectorAll('.incs-route')
          a.forEach((el) => {
            el.innerHTML = ''
            IncludHtml.doInsertInto(
              el,
              () => {
                console.log("IncludHtml.doInsertInto Finish: Ok");
              }
            )
          })
        }else{
          if(pageParamsChanged){
            console.log("pageParamsChanged '%pageParams%': ", IncludHtml.routes['%pageParams%']);
          }
        }
      }else{
        console.log('Link to Inner ref: ' + location.hash)
        location.hash = IncludHtml.routes['%lastHash%']
      }
    }

    // window.onload = () => console.log('window onload');
    document.addEventListener("DOMContentLoaded", function () {
      IncludHtml.routes[''] =        {hash: '!index', url:'page-index/main.html#extId', title:'main page'};
      IncludHtml.routes['!index'] =  {hash: '!index', url:'page-index/main.html#extId', title:'main page'};
      IncludHtml.routes['!about'] =  {hash: '!about', url:'page-about/main.html#extId', title:'about page'};
      // Ð²ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ðŸ‘‡
      IncludHtml.routes['%lastHash%'] = false;
      IncludHtml.routes['%routePage%'] = 'page-index/main.html#'; // ðŸ‘ˆ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ñ‡Ð°ÑÑ‚Ð¸ ÑÑ‚Ñ€.

      IncludHtml.doIncludAll(
        {
          insertType: "append",
          incInner: false,
          replace: [
            { from: 'src="../img/', to: 'src="./img/' },
          ],
          "incFromId": "extId"
        },
        () => {
          hashchangeHandler()
          window.addEventListener('hashchange', hashchangeHandler);
        }

        // ,
        // () => {
        //   console.log("IncludHtml.doIncludAll Finish: Ok"); // Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð³Ð´Ð° IncludHtml Ð²ÑÑ‘ ÑÐ´ÐµÐ»Ð°Ð»
        //   // Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ð° IncludHtml.doInsertInto
        //   // Ð² main Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‹ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ðµ Ð² ÐµÐ³Ð¾ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ðµ data-incs='{ "incFile": "./inc/main.html#extId" }'
        //   //  Ñ‚.Ðµ. ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ñ‹Ð¼ ./inc/main.html Ñ id="extId"
        //   let el = document.querySelector('main');
        //   IncludHtml.doInsertInto(
        //     el,
        //     () => {
        //       console.log("IncludHtml.doInsertInto Finish: Ok");
        //     }
        //   )
        // }
      );
      /*
            IncludHtml.doIncludAll(
              {
                insertType: "append",
                replace: [
                  { from: 'src="../asset/img/', to: 'src="./asset/img/' },
                  { from: 'src="../asset/svg/', to: 'src="./asset/svg/' }
                ],
                "incFromId": "extId"
              },
              () => {
                // console.log("IncludHtml Finish: Ok"); // Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð³Ð´Ð° IncludHtml Ð²ÑÑ‘ ÑÐ´ÐµÐ»Ð°Ð»
                // Ð¿Ñ€ÑÑ‡ÐµÐ¼ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
                if (typeof (root1Off) === 'undefined' || !root1Off) {
                  try {
                    document.querySelector("body .root1").style.display = "";
                  } catch (e) { }
                  try {
                    document.querySelector("body .root2").style.display = "none";
                  } catch (e) { }
                }

                // Ð¿Ð¾ currPage Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ 'page-selected' ÐºÐ»Ð°ÑÑ
                document.querySelectorAll(`.root1 .${currPageClass}`).forEach((el) => {
                  el.classList.add("page-selected");
                });
              }
            );
      */
    });
  </script>
</body>

</html>
