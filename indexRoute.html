<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IncludHtml library</title>

<!-- 
  https://github.com/krasimir/navigo
  https://github.com/krasimir/navigo/blob/master/DOCUMENTATION.md
  <script src="https://cdnjs.cloudflare.com/ajax/libs/navigo/8.11.1/navigo.min.js" integrity="sha512-J8D8QABVZk+v5H+5nllq6DgHBiOcmhRjqAgJZm4d4d46JUBc1yrasvzbxbwNFLsK3FZmAS4TnjSyR5j7dyxdpw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
-->

  <script src="./IncludHtml.js" defer></script>
</head>

<body>

  <header>
    <h2>header</h2>
    <a href="#">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#index">home1</a>&nbsp;&nbsp;&nbsp;
    <a href="#about">about</a>&nbsp;&nbsp;&nbsp;
    <a href="#nopage">404</a>&nbsp;&nbsp;&nbsp;
  </header>

  <!-- <section class="incs herro"
  data-incs='{"incFile": "./page-index/a_herro.html" }'
  ></section> -->
<!-- 
  "incFile": "./inc/main.html#extId", // Ð¿ÑƒÑ‚ÑŒ Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¸ id Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ÑƒÑŽ Ñ‡Ð°ÑÑ‚ÑŒ
  "incInner" : true,  // [true], false -  Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ÑƒÑŽ Ñ‡Ð°ÑÑ‚ÑŒ: 
                                        // true/false - innerHTML/outerHTML; 
  "insertType": "replace",  // ["replace"],  "append", "prepend", - ÐºÑƒÐ´Ð° Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼Ð¾Ðµ
  "incFromId": "extId"
 -->
  <main class="main incs-route" data-incs='{ "incFile": "./%routePage%" }'>
  </main>

  <footer><h2>footer</h2></footer>

  <script>
    const routes = [];
    routes[''] =      'page-index/main.html#extId';
    routes['index'] = 'page-index/main.html#extId';
    routes['about'] = 'page-about/main.html#extId';
    routes['*'] = 'main404.html#extId';
    // Ð²ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ðŸ‘‡
    routes['%routeRaw%'] = 'page-index/main.html';
    routes['%routePage%'] = 'page-index/main.html#';
    const hashchangeHandler = () => {
      const h = location.hash.replaceAll('#','')
      const url = routes[h.split('/')[0]]??routes['*']
      const prevPage = routes['%routePage%']
      routes['%routeRaw%'] = h;
      routes['%routePage%'] = url;
      if(prevPage !== routes['%routePage%']) {
        console.log('hashchange routeRaw:', routes['%routeRaw%'], 'routePage:', routes['%routePage%'])
        const a = document.querySelectorAll('.incs-route')
        a.forEach((el) => {
          el.innerHTML = ''
          IncludHtml.doInsertInto(
            el,
            () => {
              console.log("IncludHtml.doInsertInto Finish: Ok");
            }
          )
        })
      }
    }

    // window.onload = () => console.log('window onload');
    document.addEventListener("DOMContentLoaded", function () {

      IncludHtml.doIncludAll(
        {
          insertType: "append",
          incInner: false,
          replace: [
            { from: 'src="../img/', to: 'src="./img/' },
          ],
          "incFromId": "extId"
        },
        () => {
          hashchangeHandler()
          window.addEventListener('hashchange', hashchangeHandler);    
        }

        // ,
        // () => {
        //   console.log("IncludHtml.doIncludAll Finish: Ok"); // Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð³Ð´Ð° IncludHtml Ð²ÑÑ‘ ÑÐ´ÐµÐ»Ð°Ð»
        //   // Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ð° IncludHtml.doInsertInto
        //   // Ð² main Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‹ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ðµ Ð² ÐµÐ³Ð¾ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ðµ data-incs='{ "incFile": "./inc/main.html#extId" }'
        //   //  Ñ‚.Ðµ. ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ñ‹Ð¼ ./inc/main.html Ñ id="extId"
        //   let el = document.querySelector('main');
        //   IncludHtml.doInsertInto(
        //     el,
        //     () => {
        //       console.log("IncludHtml.doInsertInto Finish: Ok");
        //     }
        //   )
        // }
      );
      /*
            IncludHtml.doIncludAll(
              {
                insertType: "append",
                replace: [
                  { from: 'src="../asset/img/', to: 'src="./asset/img/' },
                  { from: 'src="../asset/svg/', to: 'src="./asset/svg/' }
                ],
                "incFromId": "extId"
              },
              () => {
                // console.log("IncludHtml Finish: Ok"); // Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÐºÐ¾Ð³Ð´Ð° IncludHtml Ð²ÑÑ‘ ÑÐ´ÐµÐ»Ð°Ð»
                // Ð¿Ñ€ÑÑ‡ÐµÐ¼ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
                if (typeof (root1Off) === 'undefined' || !root1Off) {
                  try {
                    document.querySelector("body .root1").style.display = "";
                  } catch (e) { }
                  try {
                    document.querySelector("body .root2").style.display = "none";
                  } catch (e) { }
                }
      
                // Ð¿Ð¾ currPage Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ 'page-selected' ÐºÐ»Ð°ÑÑ
                document.querySelectorAll(`.root1 .${currPageClass}`).forEach((el) => {
                  el.classList.add("page-selected");
                });
              }
            );
      */
    });
  </script>
</body>

</html>